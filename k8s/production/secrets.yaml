# Production Kubernetes Secrets
# Story 5.2: Deploy Application to Production Environment
# IMPORTANT: These are TEMPLATES - replace placeholder values before deployment
#
# To create secrets from actual credentials:
# kubectl create secret generic db-credentials \
#   --from-literal=DATABASE_URL='postgresql+asyncpg://user:password@rds-endpoint:5432/aiagents?sslmode=require' \
#   -n production
#
# For base64 encoding values:
# echo -n 'your-secret-value' | base64

---
apiVersion: v1
kind: Secret
metadata:
  name: db-credentials
  namespace: production
  labels:
    app: ai-agents
    component: database
type: Opaque
stringData:
  # PostgreSQL connection string from Story 5.1 Terraform outputs
  # Format: postgresql+asyncpg://user:password@hostname:5432/database?sslmode=require
  # REPLACE with actual RDS endpoint from: terraform output -json | jq '.db_endpoint.value'
  DATABASE_URL: "postgresql+asyncpg://aiagents:REPLACE_WITH_PASSWORD@REPLACE_WITH_RDS_ENDPOINT:5432/aiagents?sslmode=require"

---
apiVersion: v1
kind: Secret
metadata:
  name: redis-credentials
  namespace: production
  labels:
    app: ai-agents
    component: cache
type: Opaque
stringData:
  # Redis connection string from Story 5.1 Terraform outputs
  # Format: rediss://hostname:6379/0 (rediss:// for TLS encryption)
  # REPLACE with actual ElastiCache endpoint from: terraform output -json | jq '.redis_endpoint.value'
  REDIS_URL: "rediss://REPLACE_WITH_ELASTICACHE_ENDPOINT:6379/0"
  CELERY_BROKER_URL: "rediss://REPLACE_WITH_ELASTICACHE_ENDPOINT:6379/0"
  CELERY_RESULT_BACKEND: "rediss://REPLACE_WITH_ELASTICACHE_ENDPOINT:6379/1"

---
apiVersion: v1
kind: Secret
metadata:
  name: openai-credentials
  namespace: production
  labels:
    app: ai-agents
    component: ai-service
type: Opaque
stringData:
  # OpenAI API key for GPT-4 context synthesis (from Epic 2)
  # REPLACE with actual production OpenAI API key
  OPENAI_API_KEY: "sk-proj-REPLACE_WITH_OPENAI_API_KEY"

---
apiVersion: v1
kind: Secret
metadata:
  name: servicedesk-credentials
  namespace: production
  labels:
    app: ai-agents
    component: webhook
type: Opaque
stringData:
  # ServiceDesk Plus webhook signing secret for signature validation (from Epic 2)
  # REPLACE with actual webhook secret from ServiceDesk Plus configuration
  WEBHOOK_SECRET: "REPLACE_WITH_SERVICEDESK_WEBHOOK_SECRET"
  # ServiceDesk Plus API credentials for ticket updates
  SERVICEDESK_API_URL: "https://REPLACE_WITH_SERVICEDESK_URL/api/v3"
  SERVICEDESK_API_KEY: "REPLACE_WITH_SERVICEDESK_API_KEY"

---
# Note: All secrets are encrypted at rest via AWS KMS (configured in Story 5.1)
# Secrets are injected into pods as environment variables via secretKeyRef
# Never commit actual credential values to version control
#
# Production deployment checklist:
# 1. Replace all REPLACE_WITH_* placeholders with actual values
# 2. Verify DATABASE_URL includes ?sslmode=require for TLS
# 3. Verify REDIS_URL uses rediss:// protocol for encryption
# 4. Apply secrets: kubectl apply -f k8s/production/secrets.yaml
# 5. Verify secrets created: kubectl get secrets -n production
# 6. Test secret injection: kubectl exec -it <pod> -n production -- env | grep DATABASE_URL
