# Kubernetes Secret for Uptrace DSN (Story 12.8 AC4)
#
# This secret stores the Uptrace Data Source Name (DSN) for production tracing.
# The DSN contains authentication credentials for the Uptrace OTLP endpoint.
#
# Usage:
# 1. Replace <PROJECT_ID> and <TOKEN> with your actual Uptrace credentials
# 2. Replace <UPTRACE_INSTANCE> with your Uptrace instance hostname
# 3. Apply: kubectl apply -f k8s/uptrace-secret.yaml -n ai-agents
# 4. Reference in deployment via secretKeyRef (see deployment.yaml example below)
#
# Security Notes:
# - DO NOT commit this file with real credentials to version control
# - Store actual credentials in a secure vault (1Password, AWS Secrets Manager, etc.)
# - Use kubectl create secret or sealed-secrets for GitOps workflows
# - Rotate DSN tokens regularly following security best practices

apiVersion: v1
kind: Secret
metadata:
  name: uptrace-credentials
  namespace: ai-agents
  labels:
    app: ai-agents
    component: observability
    managed-by: story-12.8
type: Opaque
stringData:
  # Uptrace DSN Format: https://PROJECT_ID:TOKEN@uptrace.example.com
  # Get from: Uptrace Dashboard → Project Settings → DSN
  dsn: "https://<PROJECT_ID>:<TOKEN>@<UPTRACE_INSTANCE>"

  # Uptrace OTLP Endpoint Format: https://uptrace.example.com:4317
  # Get from: Uptrace Dashboard → Project Settings → OTLP Endpoint
  endpoint: "https://<UPTRACE_INSTANCE>:4317"

---
# Example Deployment Configuration (Reference Only)
#
# This shows how to reference the Uptrace secret in your deployment.
# Add these env vars to your existing deployment.yaml file.

# apiVersion: apps/v1
# kind: Deployment
# metadata:
#   name: ai-agents-api
#   namespace: ai-agents
# spec:
#   template:
#     spec:
#       containers:
#       - name: api
#         image: ai-agents:latest
#         env:
#         # Story 12.8 AC4: Uptrace Backend Configuration
#         - name: OTEL_BACKEND
#           value: "uptrace"
#
#         - name: UPTRACE_DSN
#           valueFrom:
#             secretKeyRef:
#               name: uptrace-credentials
#               key: dsn
#
#         - name: UPTRACE_OTLP_ENDPOINT
#           valueFrom:
#             secretKeyRef:
#               name: uptrace-credentials
#               key: endpoint
#
#         # Other existing env vars...
#         - name: OTEL_SERVICE_NAME
#           value: "ai-agents-enhancement"
#
#         - name: OTEL_TRACES_SAMPLER
#           value: "traceidratio"
#
#         - name: OTEL_TRACES_SAMPLER_ARG
#           value: "0.1"  # 10% sampling for production
#
#         - name: DEPLOYMENT_ENV
#           value: "production"
