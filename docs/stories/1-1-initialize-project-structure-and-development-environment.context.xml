<story-context id="bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>1</storyId>
    <title>Initialize Project Structure and Development Environment</title>
    <status>drafted</status>
    <generatedAt>2025-11-01</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/1-1-initialize-project-structure-and-development-environment.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>developer</asA>
    <iWant>a well-organized project structure with Python dependencies managed</iWant>
    <soThat>I can start building features with a solid foundation</soThat>
    <tasks>
      <task id="1" ac="1">
        <description>Create project directory structure</description>
        <subtasks>
          <item>Create root project directory structure with folders: src/, tests/, docs/, docker/, k8s/, alembic/</item>
          <item>Create src/ subdirectories: api/, database/, cache/, services/, workers/, enhancement/, monitoring/, utils/, schemas/</item>
          <item>Create tests/ subdirectories: unit/, integration/, conftest.py</item>
          <item>Create docs/ with initial files: architecture.md (existing), PRD.md (existing), epics.md (existing)</item>
          <item>Create docker/ directory for Dockerfiles</item>
          <item>Create k8s/ directory for Kubernetes manifests</item>
          <item>Add __init__.py files to all Python package directories</item>
        </subtasks>
      </task>
      <task id="2" ac="2,3,4">
        <description>Initialize Python dependency management</description>
        <subtasks>
          <item>Create pyproject.toml with project metadata and dependencies</item>
          <item>Define core dependencies: fastapi>=0.104.0, uvicorn[standard]>=0.24.0, pydantic>=2.5.0, pydantic-settings>=2.1.0, sqlalchemy[asyncio]>=2.0.23, alembic>=1.12.1, asyncpg>=0.29.0, redis>=5.0.1, celery[redis]>=5.3.4, httpx>=0.25.2, loguru>=0.7.2</item>
          <item>Define dev dependencies: pytest>=7.4.3, pytest-asyncio>=0.21.1, black>=23.11.0, ruff>=0.1.6, mypy>=1.7.1</item>
          <item>Create virtual environment: python3.12 -m venv venv</item>
          <item>Test dependency installation: pip install -e .</item>
        </subtasks>
      </task>
      <task id="3" ac="5">
        <description>Configure .gitignore</description>
        <subtasks>
          <item>Create .gitignore with Python-specific entries</item>
          <item>Add entries: .env, __pycache__/, *.pyc, *.pyo, venv/, .venv/, .pytest_cache/, .mypy_cache/, .ruff_cache/</item>
          <item>Add: *.db, *.sqlite, .DS_Store, .idea/, .vscode/</item>
          <item>Add: alembic/versions/*.py (exclude migration files initially, uncomment when ready)</item>
          <item>Verify .env is git-ignored</item>
        </subtasks>
      </task>
      <task id="4" ac="6">
        <description>Create README.md with setup instructions</description>
        <subtasks>
          <item>Add project title and description</item>
          <item>Document prerequisites: Python 3.12+, Docker Desktop, Git</item>
          <item>Document local setup steps: Clone repository, Create virtual environment, Install dependencies, Copy .env.example to .env, Run docker-compose up (future story)</item>
          <item>Add project structure overview</item>
          <item>Add links to docs/ folder for architecture and PRD</item>
          <item>Add placeholder for contributing guidelines</item>
        </subtasks>
      </task>
      <task id="5" ac="7">
        <description>Create environment configuration template</description>
        <subtasks>
          <item>Create .env.example with template variables</item>
          <item>Add database URL: AI_AGENTS_DATABASE_URL=postgresql+asyncpg://user:pass@localhost:5432/ai_agents</item>
          <item>Add Redis URL: AI_AGENTS_REDIS_URL=redis://localhost:6379/0</item>
          <item>Add Celery broker: AI_AGENTS_CELERY_BROKER_URL=redis://localhost:6379/1</item>
          <item>Add environment: AI_AGENTS_ENVIRONMENT=development</item>
          <item>Add log level: AI_AGENTS_LOG_LEVEL=INFO</item>
          <item>Document each variable with comments</item>
        </subtasks>
      </task>
      <task id="6" ac="3">
        <description>Initialize configuration module</description>
        <subtasks>
          <item>Create src/config.py with Pydantic Settings class</item>
          <item>Define Settings with fields: database_url, redis_url, celery_broker_url, environment, log_level</item>
          <item>Configure env_prefix = "AI_AGENTS_"</item>
          <item>Set defaults for pool sizes and connection limits</item>
          <item>Export settings instance for import by other modules</item>
        </subtasks>
      </task>
      <task id="7" ac="1">
        <description>Create initial placeholder modules</description>
        <subtasks>
          <item>Create src/main.py with minimal FastAPI app initialization</item>
          <item>Create src/database/__init__.py, src/database/models.py (placeholder)</item>
          <item>Create src/cache/__init__.py, src/cache/redis_client.py (placeholder)</item>
          <item>Create src/api/__init__.py, src/api/health.py (placeholder)</item>
          <item>Create src/workers/__init__.py, src/workers/celery_app.py (placeholder)</item>
          <item>Create src/utils/__init__.py, src/utils/logger.py (placeholder)</item>
        </subtasks>
      </task>
      <task id="8" ac="7">
        <description>Write unit tests for configuration</description>
        <subtasks>
          <item>Create tests/unit/test_config.py</item>
          <item>Test Settings loads from environment variables</item>
          <item>Test Settings uses defaults when env vars missing</item>
          <item>Test env_prefix correctly prepends to variable names</item>
          <item>Run tests with pytest: pytest tests/unit/test_config.py -v</item>
        </subtasks>
      </task>
      <task id="9" ac="7">
        <description>Validation and documentation</description>
        <subtasks>
          <item>Verify all dependencies install without errors</item>
          <item>Verify project structure matches architecture.md specification</item>
          <item>Verify .gitignore prevents .env from being committed</item>
          <item>Test README instructions: new developer can follow and set up project</item>
          <item>Commit initial project structure to git</item>
        </subtasks>
      </task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion id="1">Project directory structure created following Python best practices (src/, tests/, docs/, docker/, k8s/)</criterion>
    <criterion id="2">Python 3.12+ virtual environment configured</criterion>
    <criterion id="3">Core dependencies installed (FastAPI, LangGraph, SQLAlchemy, Redis client, pytest)</criterion>
    <criterion id="4">requirements.txt and/or pyproject.toml file created</criterion>
    <criterion id="5">.gitignore configured for Python projects</criterion>
    <criterion id="6">README.md with initial setup instructions</criterion>
    <criterion id="7">All dependencies install successfully with `pip install -r requirements.txt`</criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/architecture.md</path>
        <title>AI Agents - Decision Architecture</title>
        <section>Project Structure</section>
        <snippet>Defines complete directory structure with src/, tests/, docs/, docker/, k8s/, alembic/ folders. Specifies module organization: src/api/, src/database/, src/cache/, src/services/, src/workers/, src/enhancement/, src/monitoring/, src/utils/, src/schemas/. Establishes tests/ mirroring src/ structure with unit/ and integration/ subdirectories.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>AI Agents - Decision Architecture</title>
        <section>Technology Stack Details</section>
        <snippet>Python 3.12 with FastAPI 0.104+, Pydantic 2.x for validation, Uvicorn as ASGI server. PostgreSQL 17 with SQLAlchemy 2.0+ and Alembic migrations. Redis 7.x with Celery 5.x for task processing. Development tools: Black, Ruff, Mypy, Pytest with pytest-asyncio.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>AI Agents - Decision Architecture</title>
        <section>Implementation Patterns - Naming Conventions</section>
        <snippet>Files/modules: snake_case (e.g., redis_client.py). Classes: PascalCase (e.g., Settings, RedisClient). Functions/variables: snake_case. Constants: UPPER_SNAKE_CASE. Environment variables: UPPER_SNAKE_CASE with AI_AGENTS_ prefix.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>AI Agents - Decision Architecture</title>
        <section>Configuration Management</section>
        <snippet>Pydantic Settings pattern with env_file=".env" and env_prefix="AI_AGENTS_". Environment variables: AI_AGENTS_DATABASE_URL, AI_AGENTS_REDIS_URL, AI_AGENTS_OPENAI_API_KEY, AI_AGENTS_CELERY_BROKER_URL, AI_AGENTS_ENVIRONMENT.</snippet>
      </doc>
      <doc>
        <path>docs/tech-spec-epic-1.md</path>
        <title>Epic Technical Specification: Foundation & Infrastructure Setup</title>
        <section>Detailed Design - Data Models and Contracts</section>
        <snippet>Pydantic Configuration Model defines Settings class with fields: database_url, database_pool_size (default 20), redis_url, redis_max_connections (default 10), celery_broker_url, celery_result_backend, environment (default "development"), log_level (default "INFO"). Uses env_prefix = "AI_AGENTS_" and env_file = ".env".</snippet>
      </doc>
      <doc>
        <path>docs/tech-spec-epic-1.md</path>
        <title>Epic Technical Specification: Foundation & Infrastructure Setup</title>
        <section>Dependencies and Integrations</section>
        <snippet>Python Dependencies in pyproject.toml: fastapi>=0.104.0, uvicorn[standard]>=0.24.0, pydantic>=2.5.0, pydantic-settings>=2.1.0, sqlalchemy[asyncio]>=2.0.23, alembic>=1.12.1, asyncpg>=0.29.0, redis>=5.0.1, celery[redis]>=5.3.4, httpx>=0.25.2, loguru>=0.7.2. Dev dependencies: pytest>=7.4.3, pytest-asyncio>=0.21.1, black>=23.11.0, ruff>=0.1.6, mypy>=1.7.1.</snippet>
      </doc>
      <doc>
        <path>docs/epics.md</path>
        <title>AI Agents - Epic Breakdown</title>
        <section>Story 1.1: Initialize Project Structure and Development Environment</section>
        <snippet>As a developer, I want a well-organized project structure with Python dependencies managed, so that I can start building features with a solid foundation. Acceptance criteria include: project directory structure (src/, tests/, docs/, docker/, k8s/), Python 3.12+ virtual environment, core dependencies installed, pyproject.toml file, .gitignore configured, README.md with setup instructions, and successful dependency installation.</snippet>
      </doc>
      <doc>
        <path>docs/PRD.md</path>
        <title>AI Agents Product Requirements Document (PRD)</title>
        <section>Goals and Background Context</section>
        <snippet>Build a multi-tenant platform for MSP technicians with AI enhancement agents. Establish production-ready foundation with monitoring, guardrails, and modular architecture. Project Level 3: Complex integration - platform features, major integrations, architectural changes.</snippet>
      </doc>
    </docs>
    <code>
      <!-- No existing code - new project initialization -->
    </code>
    <dependencies>
      <python>
        <core>
          <package name="fastapi" version=">=0.104.0" purpose="Async web framework with automatic OpenAPI docs"/>
          <package name="uvicorn" version=">=0.24.0" extras="standard" purpose="ASGI server for running FastAPI"/>
          <package name="pydantic" version=">=2.5.0" purpose="Data validation (included with FastAPI)"/>
          <package name="pydantic-settings" version=">=2.1.0" purpose="Environment-based configuration"/>
          <package name="sqlalchemy" version=">=2.0.23" extras="asyncio" purpose="Async ORM with modern API"/>
          <package name="alembic" version=">=1.12.1" purpose="Database migration tool (industry standard)"/>
          <package name="asyncpg" version=">=0.29.0" purpose="Fast async PostgreSQL driver"/>
          <package name="redis" version=">=5.0.1" purpose="Broker for Celery + caching layer"/>
          <package name="celery" version=">=5.3.4" extras="redis" purpose="Distributed task queue"/>
          <package name="httpx" version=">=0.25.2" purpose="Modern async HTTP client"/>
          <package name="loguru" version=">=0.7.2" purpose="Simple, powerful logging library"/>
        </core>
        <dev>
          <package name="pytest" version=">=7.4.3" purpose="Testing framework with async support"/>
          <package name="pytest-asyncio" version=">=0.21.1" purpose="Pytest plugin for async tests"/>
          <package name="black" version=">=23.11.0" purpose="Code formatter"/>
          <package name="ruff" version=">=0.1.6" purpose="Fast Python linter"/>
          <package name="mypy" version=">=1.7.1" purpose="Static type checker"/>
        </dev>
      </python>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint type="python-version">Must use Python 3.12+ (architecture requirement). Security support until 2028, good library ecosystem compatibility.</constraint>
    <constraint type="virtual-environment">Required for dependency isolation. Use venv (standard library) rather than conda/poetry. Activate before installing dependencies.</constraint>
    <constraint type="git-workflow">.env MUST be git-ignored (contains sensitive data). .env.example provides template for developers. Never commit API keys or passwords.</constraint>
    <constraint type="file-paths">All paths must work cross-platform (Windows, macOS, Linux). Use pathlib for path manipulation. Avoid hardcoded absolute paths.</constraint>
    <constraint type="dependency-management">Use pyproject.toml (modern Python standard) instead of requirements.txt. All versions must match architecture.md Decision Summary table.</constraint>
    <constraint type="naming-convention">Files/modules: snake_case. Classes: PascalCase. Functions/variables: snake_case. Constants: UPPER_SNAKE_CASE. Environment variables: UPPER_SNAKE_CASE with AI_AGENTS_ prefix.</constraint>
    <constraint type="configuration">Pydantic Settings for type-safe configuration. Environment variables with AI_AGENTS_ prefix for namespace isolation. .env file for local development (git-ignored). Kubernetes Secrets for production (future story).</constraint>
    <constraint type="code-quality">Black for code formatting. Ruff for linting (faster replacement for Flake8). Mypy for static type checking. Pytest for testing framework.</constraint>
  </constraints>

  <interfaces>
    <interface>
      <name>Settings</name>
      <kind>Pydantic Settings Class</kind>
      <signature>
class Settings(BaseSettings):
    database_url: str
    database_pool_size: int = 20
    redis_url: str
    redis_max_connections: int = 10
    celery_broker_url: str
    celery_result_backend: str
    environment: str = "development"
    log_level: str = "INFO"

    class Config:
        env_file = ".env"
        env_prefix = "AI_AGENTS_"
      </signature>
      <path>src/config.py</path>
      <reason>Core configuration module to be created in this story. All services will import settings from this module.</reason>
    </interface>
    <interface>
      <name>Environment Variables</name>
      <kind>Configuration Pattern</kind>
      <signature>
AI_AGENTS_DATABASE_URL=postgresql+asyncpg://user:pass@localhost:5432/ai_agents
AI_AGENTS_REDIS_URL=redis://localhost:6379/0
AI_AGENTS_CELERY_BROKER_URL=redis://localhost:6379/1
AI_AGENTS_ENVIRONMENT=development
AI_AGENTS_LOG_LEVEL=INFO
      </signature>
      <path>.env.example</path>
      <reason>Template for environment configuration. Developers copy to .env for local development.</reason>
    </interface>
  </interfaces>

  <tests>
    <standards>
Test configuration loading with different environment variables. Test default values are applied correctly. Mock external dependencies (database, Redis). Aim for 80% code coverage (per architecture.md). Use pytest with pytest-asyncio for async tests. Tests organized in tests/unit/ (fast, isolated) and tests/integration/ (multi-component). Shared pytest fixtures in tests/conftest.py.</standards>
    <locations>
      <location>tests/unit/</location>
      <location>tests/integration/</location>
      <location>tests/conftest.py</location>
    </locations>
    <ideas>
      <idea ac="7" priority="high">
        <file>tests/unit/test_config.py</file>
        <description>Test Settings loads from environment variables correctly</description>
        <approach>Set environment variables, instantiate Settings, assert values match</approach>
      </idea>
      <idea ac="7" priority="high">
        <file>tests/unit/test_config.py</file>
        <description>Test Settings uses default values when env vars missing</description>
        <approach>Unset optional env vars, instantiate Settings, assert defaults applied (database_pool_size=20, log_level="INFO")</approach>
      </idea>
      <idea ac="7" priority="high">
        <file>tests/unit/test_config.py</file>
        <description>Test env_prefix correctly prepends to variable names</description>
        <approach>Set AI_AGENTS_DATABASE_URL, verify Settings.database_url loads correctly</approach>
      </idea>
      <idea ac="1" priority="medium">
        <file>tests/unit/test_project_structure.py</file>
        <description>Verify all required directories exist after setup</description>
        <approach>Check for existence of src/, tests/, docs/, docker/, k8s/, alembic/ and all subdirectories</approach>
      </idea>
      <idea ac="5" priority="medium">
        <file>tests/unit/test_gitignore.py</file>
        <description>Verify .gitignore prevents .env from being committed</description>
        <approach>Check .gitignore contains .env pattern, test that .env file would be ignored by git</approach>
      </idea>
    </ideas>
  </tests>
</story-context>
