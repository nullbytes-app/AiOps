<story-context id="bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>7</epicId>
    <storyId>7</storyId>
    <title>Document Plugin Architecture and Extension Guide</title>
    <status>drafted</status>
    <generatedAt>2025-11-05</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>/Users/ravi/Documents/nullBytes_Apps/Ai_Agents/AI Ops/docs/stories/7-7-document-plugin-architecture-and-extension-guide.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>a future developer or contributor</asA>
    <iWant>comprehensive plugin architecture documentation with step-by-step development guides and templates</iWant>
    <soThat>I can create new ticketing tool plugins independently without deep knowledge of the existing codebase</soThat>
    <tasks>
      <task id="1" ac="1">Analyze and Plan Documentation Restructure - Read plugin-architecture.md (3,079 lines), identify sections for splitting based on Diátaxis framework, design modular structure with 7 files (overview, interface-reference, manager-guide, examples, type-safety, error-handling, performance)</task>
      <task id="2" ac="1">Split plugin-architecture.md into Modular Files - Create docs/plugins/ directory, extract and create 7 modular files (~400-450 lines each), update original as navigation hub (≤300 lines), add cross-reference links with breadcrumbs</task>
      <task id="3" ac="2">Create Plugin Development Guide - Create plugin-development-guide.md with step-by-step Zendesk tutorial (15 steps from setup to deployment), code examples, testing section, next steps</task>
      <task id="4" ac="3">Create Plugin Template - Create src/plugins/_template/ with __init__.py, plugin.py (~250 lines), api_client.py (~200 lines), webhook_validator.py (~150 lines), README.md, all with TODO comments</task>
      <task id="5" ac="4">Document Testing Requirements - Create plugin-testing-guide.md with testing overview, strategy (3-layer pyramid), mock plugin usage, fixtures, minimum coverage requirements, CI/CD integration, performance testing</task>
      <task id="6" ac="5">Create Plugin Submission Guidelines - Create plugin-submission-guidelines.md with code review checklist (10 items), documentation requirements, testing requirements, security requirements, performance requirements, submission process, PR template</task>
      <task id="7" ac="6">Create Troubleshooting Guide - Create plugin-troubleshooting.md with common development errors, debugging techniques, type checking issues, testing issues, plugin registration problems, webhook validation failures, API integration issues</task>
      <task id="8" ac="7">Document Future Plugin Roadmap - Create plugin-roadmap.md with Priority 1 plugins (Zendesk, ServiceNow Q1 2026), Priority 2-3 plugins, custom plugin development, versioning strategy, deprecation policy, community contributions</task>
      <task id="9" ac="8">Update README.md - Add Plugin Architecture section with overview (2-3 paragraphs), Supported Ticketing Tools subsection, Plugin Developer Quick Start, Plugin Documentation links, Contributing subsection</task>
      <task id="10">Create Documentation Index and Navigation - Create docs/plugins/index.md as central hub, organize by Diátaxis categories, add quick links, breadcrumbs to all files, verify cross-references</task>
      <task id="11">Quality Assurance and Validation - Verify all files ≤500 lines, syntax highlighting on code blocks, external references cited, spell check, Diátaxis framework applied correctly, all ACs have evidence</task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion id="AC1">docs/plugin-architecture.md restructured into modular files (≤500 lines each) with architecture overview, plugin interface spec, and plugin manager usage examples</criterion>
    <criterion id="AC2">docs/plugin-development-guide.md created with step-by-step tutorial following Diátaxis framework for building a plugin from scratch</criterion>
    <criterion id="AC3">src/plugins/_template/ directory created with boilerplate plugin template (plugin.py, api_client.py, webhook_validator.py) with TODO comments</criterion>
    <criterion id="AC4">Testing requirements documented with references to tests/README-plugins.md (from Story 7.6) and testing strategy overview</criterion>
    <criterion id="AC5">Plugin submission guidelines created (docs/plugins/plugin-submission-guidelines.md) with code review checklist and quality requirements</criterion>
    <criterion id="AC6">Troubleshooting guide created (docs/plugins/plugin-troubleshooting.md) with common errors, debugging tips, and solutions</criterion>
    <criterion id="AC7">Future plugin roadmap documented (docs/plugins/plugin-roadmap.md) covering Zendesk, ServiceNow, Freshservice, and community contributions</criterion>
    <criterion id="AC8">README.md updated with Plugin Architecture section, supported tools list, and links to all plugin documentation</criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/PRD.md</path>
        <title>Product Requirements Document</title>
        <section>Epic 7: Plugin Architecture & Multi-Tool Support</section>
        <snippet>FR034-FR039 define plugin architecture requirements: standardized interface for multiple ticketing tools, dynamic plugin loading, tool-agnostic core enhancement logic. System shall support Jira, ServiceDesk Plus, and future tools via plugin pattern.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>System Architecture Document</title>
        <section>ADR-010: Plugin Architecture for Multi-Tool Support, Project Structure src/plugins/</section>
        <snippet>Defines plugin directory structure (src/plugins/base.py, registry.py, tool implementations). TicketingToolPlugin ABC pattern with 4 abstract methods. Plugin Manager routes tenant requests to appropriate tool plugin.</snippet>
      </doc>
      <doc>
        <path>docs/epics.md</path>
        <title>Epic Definitions</title>
        <section>Epic 7: Stories 7.1-7.7</section>
        <snippet>Story 7.7 creates comprehensive documentation for plugin architecture. Prerequisites: Stories 7.1-7.6 complete (base interface, manager, ServiceDesk Plus migration, Jira plugin, database schema, testing framework). Goal: Enable future developers to create plugins independently.</snippet>
      </doc>
      <doc>
        <path>docs/plugin-architecture.md</path>
        <title>Plugin Architecture Documentation (Current - 3,079 lines)</title>
        <section>Complete plugin architecture reference</section>
        <snippet>REQUIRES SPLITTING per AC1: Currently 3,079 lines (6x over 500-line constraint). Contains: interface specification, manager guide, examples, type safety, error handling, performance considerations. Must be split into 7-8 modular files.</snippet>
      </doc>
      <doc>
        <path>tests/README-plugins.md</path>
        <title>Plugin Testing Guide (Story 7.6)</title>
        <section>Testing framework overview</section>
        <snippet>Comprehensive testing framework from Story 7.6. Provides MockTicketingToolPlugin, test fixtures, utilities. Three-layer strategy: unit tests (plugin methods), integration tests (workflows), E2E tests (real APIs optional). Reference for AC4 testing requirements.</snippet>
      </doc>
      <doc>
        <path>tests/docs/plugin-testing-best-practices.md</path>
        <title>Plugin Testing Best Practices (Story 7.6)</title>
        <section>Testing patterns and guidelines</section>
        <snippet>Best practices for plugin testing: fixture usage, mock plugin modes (success, API error, validation failure), CI/CD integration with pytest markers, troubleshooting common test failures.</snippet>
      </doc>
      <doc>
        <path>/Users/ravi/Documents/nullBytes_Apps/.claude/CLAUDE.md</path>
        <title>Project Coding Standards</title>
        <section>File Size Constraint C1</section>
        <snippet>CRITICAL CONSTRAINT: Never create a file longer than 500 lines of code. If file approaches limit, refactor by splitting into modules. Applies to documentation files. Google-style docstrings required, Black formatting, PEP8 compliance.</snippet>
      </doc>
    </docs>
    <code>
      <artifact>
        <path>src/plugins/base.py</path>
        <kind>Abstract Base Class</kind>
        <symbol>TicketingToolPlugin</symbol>
        <lines>51-316</lines>
        <reason>Core interface definition for all plugins. Defines 4 abstract methods (validate_webhook, get_ticket, update_ticket, extract_metadata) and TicketMetadata dataclass. Essential reference for AC1 interface documentation and AC3 template creation.</reason>
      </artifact>
      <artifact>
        <path>src/plugins/registry.py</path>
        <kind>Plugin Manager</kind>
        <symbol>PluginManager</symbol>
        <lines>N/A</lines>
        <reason>Singleton pattern plugin manager. Handles plugin registration, dynamic loading, and routing. Reference for AC1 plugin-manager-guide.md documentation.</reason>
      </artifact>
      <artifact>
        <path>src/plugins/servicedesk_plus/plugin.py</path>
        <kind>Plugin Implementation</kind>
        <symbol>ServiceDeskPlusPlugin</symbol>
        <lines>N/A</lines>
        <reason>Complete ServiceDesk Plus plugin implementation (Story 7.3). Reference example for AC1 plugin-examples.md and AC3 template patterns (3-file structure: plugin.py, api_client.py, webhook_validator.py).</reason>
      </artifact>
      <artifact>
        <path>src/plugins/servicedesk_plus/api_client.py</path>
        <kind>API Client</kind>
        <symbol>ServiceDeskPlusAPIClient</symbol>
        <lines>N/A</lines>
        <reason>HTTP client for ServiceDesk Plus API. Demonstrates httpx usage, connection pooling, retry logic with exponential backoff, timeout configuration. Pattern for AC3 template api_client.py.</reason>
      </artifact>
      <artifact>
        <path>src/plugins/servicedesk_plus/webhook_validator.py</path>
        <kind>Webhook Validation</kind>
        <symbol>validate_signature</symbol>
        <lines>N/A</lines>
        <reason>HMAC-SHA256 webhook signature validation with secrets.compare_digest for timing attack prevention. Security pattern for AC3 template and AC6 troubleshooting guide.</reason>
      </artifact>
      <artifact>
        <path>src/plugins/jira/plugin.py</path>
        <kind>Plugin Implementation</kind>
        <symbol>JiraPlugin</symbol>
        <lines>N/A</lines>
        <reason>Complete Jira Service Management plugin implementation (Story 7.4). Second reference example for AC1 plugin-examples.md, demonstrates different webhook validation (JWT vs HMAC).</reason>
      </artifact>
      <artifact>
        <path>src/plugins/jira/api_client.py</path>
        <kind>API Client</kind>
        <symbol>JiraAPIClient</symbol>
        <lines>N/A</lines>
        <reason>Jira REST API client. Demonstrates OAuth/token authentication patterns, different from ServiceDesk Plus basic auth. Alternative pattern for AC3 template.</reason>
      </artifact>
      <artifact>
        <path>tests/mocks/mock_plugin.py</path>
        <kind>Mock Plugin</kind>
        <symbol>MockTicketingToolPlugin</symbol>
        <lines>N/A</lines>
        <reason>Configurable mock plugin for testing (Story 7.6). Reference for AC4 testing requirements documentation, demonstrates factory pattern for test modes (success, failure, timeout).</reason>
      </artifact>
    </code>
    <dependencies>
      <python>
        <package name="httpx" version=">=0.25.2">Async HTTP client for plugin API calls. Required for all plugin implementations (get_ticket, update_ticket methods).</package>
        <package name="pydantic" version=">=2.5.0">Data validation and settings. Used for TicketMetadata dataclass and plugin configuration validation.</package>
        <package name="fastapi" version=">=0.104.0">Web framework. Plugin webhooks received via FastAPI endpoints.</package>
        <package name="pytest" version=">=7.4.3">Testing framework. Required for plugin unit and integration tests (minimum 15 unit tests per AC4).</package>
        <package name="pytest-asyncio" version=">=0.21.1">Async test support. Required for testing async plugin methods (get_ticket, update_ticket).</package>
        <package name="pytest-mock" version=">=3.12.0">Mocking utilities. Used in plugin tests to mock external API calls.</package>
        <package name="pytest-httpx" version=">=0.22.0">httpx mocking for tests. Enables testing plugin API clients without real HTTP calls.</package>
        <package name="black" version=">=23.11.0">Code formatter. All plugin code must be Black-formatted per CLAUDE.md.</package>
        <package name="mypy" version=">=1.7.1">Static type checker. All plugins must pass mypy --strict validation per AC submission guidelines.</package>
      </python>
      <frameworks>
        <framework name="Python 3.12+">Language runtime. Required for async/await syntax and modern type hints.</framework>
        <framework name="ABC (Abstract Base Classes)">Python standard library. TicketingToolPlugin uses ABC pattern for interface definition.</framework>
        <framework name="typing">Python standard library. Type hints (Optional, Dict, List, etc.) required for all plugin methods.</framework>
        <framework name="Diátaxis Documentation Framework">Documentation methodology. Organizes docs into Tutorials, How-To Guides, Reference, Explanation per AC2 requirement.</framework>
      </frameworks>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint id="C1" source="CLAUDE.md">File Size Limit: All files (code and documentation) must be ≤500 lines. If plugin-architecture.md (3,079 lines) violates this, split into 7-8 modular files (~400-450 lines each).</constraint>
    <constraint id="C2" source="Story Dev Notes">Documentation Story: This is a pure documentation story. NO code changes to src/plugins/* except creating src/plugins/_template/ boilerplate. Focus is on comprehensive documentation enabling future plugin development.</constraint>
    <constraint id="C3" source="CLAUDE.md, AC5">Code Quality Standards: All template code must follow Google-style docstrings, Black formatting (line length ≤100), PEP8 compliance, type hints on all methods, mypy --strict validation.</constraint>
    <constraint id="C4" source="AC2, Dev Notes">Diátaxis Framework Required: Documentation must follow Diátaxis framework (Tutorials, How-To Guides, Reference, Explanation). plugin-development-guide.md must be learning-oriented with step-by-step Zendesk example.</constraint>
    <constraint id="C5" source="AC4, Story 7.6">Reference Story 7.6 Testing: AC4 testing documentation must reference tests/README-plugins.md from Story 7.6. Avoid duplicating testing framework documentation - link to it instead.</constraint>
    <constraint id="C6" source="AC3, Dev Notes">Template 3-File Pattern: Plugin template must follow proven pattern from Stories 7.3-7.4: plugin.py (main class), api_client.py (HTTP client), webhook_validator.py (signature validation). Each file ≤500 lines.</constraint>
    <constraint id="C7" source="AC5, Epic 3">Security Requirements: Template and documentation must enforce security best practices: no hardcoded secrets, webhook signature validation with secrets.compare_digest, input validation, Bandit 0 HIGH/MEDIUM findings.</constraint>
    <constraint id="C8" source="AC5, PRD NFR001">Performance Requirements: Documentation must specify NFR001 latency targets: validate_webhook <100ms, get_ticket <2s, update_ticket <3s, enhancement complete within 120s (p95 <60s).</constraint>
    <constraint id="C9" source="Dev Notes, AC1">Cross-Reference Strategy: All modular docs must have breadcrumb navigation ("Plugin Docs > Category > File"), "See also" sections, and "Next steps" linking related topics. Avoid broken links.</constraint>
    <constraint id="C10" source="AC3, Dev Notes">TODO Comment Strategy: Template files must have TODO comments at all customization points with clear guidance (e.g., "TODO: Replace with Zendesk API endpoint URL"). _template/README.md must list all TODOs as checklist.</constraint>
  </constraints>
  <interfaces>
    <interface>
      <name>TicketingToolPlugin</name>
      <kind>Abstract Base Class</kind>
      <signature>class TicketingToolPlugin(ABC): validate_webhook(payload, headers, tenant_config) -> bool, get_ticket(ticket_id, tenant_config) -> Optional[Dict], update_ticket(ticket_id, content, tenant_config) -> bool, extract_metadata(payload) -> TicketMetadata</signature>
      <path>src/plugins/base.py</path>
      <reason>Core interface all plugins must implement. Critical for AC1 (plugin-interface-reference.md documentation) and AC3 (template creation). Must document all 4 abstract methods with parameters, returns, raises, examples.</reason>
    </interface>
    <interface>
      <name>PluginManager</name>
      <kind>Singleton Registry</kind>
      <signature>class PluginManager: register_plugin(tool_type: str, plugin: TicketingToolPlugin), get_plugin(tool_type: str) -> TicketingToolPlugin, discover_plugins()</signature>
      <path>src/plugins/registry.py</path>
      <reason>Plugin registration and routing. Essential for AC1 (plugin-manager-guide.md documentation). Developers must understand how to register custom plugins in main.py and celery_app.py.</reason>
    </interface>
    <interface>
      <name>TicketMetadata</name>
      <kind>Pydantic Dataclass</kind>
      <signature>@dataclass class TicketMetadata: tenant_id: str, ticket_id: str, description: str, priority: str, created_at: datetime</signature>
      <path>src/plugins/base.py</path>
      <reason>Standardized metadata format returned by extract_metadata() method. Required for AC1 interface reference documentation and AC3 template examples.</reason>
    </interface>
    <interface>
      <name>MockTicketingToolPlugin</name>
      <kind>Test Mock</kind>
      <signature>class MockTicketingToolPlugin(TicketingToolPlugin): factory methods (success_mode, api_error_mode, validation_failure_mode, timeout_mode), configurable responses</signature>
      <path>tests/mocks/mock_plugin.py</path>
      <reason>Testing utility from Story 7.6. Referenced in AC4 testing guide documentation. Demonstrates how to test plugins without real API dependencies.</reason>
    </interface>
  </interfaces>
  <tests>
    <standards>
      This is a DOCUMENTATION STORY - no plugin code implementation, therefore no new unit tests required for plugin functionality. However, the story creates comprehensive testing documentation and a plugin template.

      Testing Standards for DOCUMENTATION (Story 7.7 Validation):
      - Verify all documentation files ≤500 lines (CLAUDE.md C1 constraint)
      - Validate all cross-reference links work correctly (no broken links)
      - Spell check all documentation files
      - Verify code examples have syntax highlighting (language tags)
      - Confirm Diátaxis framework applied correctly to categorized docs

      Testing Standards DOCUMENTED for Future Plugin Development (AC4 output):
      - Framework: pytest with pytest-asyncio for async method testing
      - Minimum Coverage: 15+ unit tests, 5+ integration tests per plugin, 80%+ code coverage
      - Three-Layer Strategy: Unit tests (plugin methods isolation), Integration tests (multi-component workflows), E2E tests (real API - optional)
      - Mock Plugin Usage: Use MockTicketingToolPlugin from Story 7.6 for testing without real API dependencies
      - Performance Testing: pytest-benchmark for latency validation (validate_webhook <100ms, get_ticket <2s, update_ticket <3s)
      - CI Integration: pytest markers (@pytest.mark.unit, @pytest.mark.integration, @pytest.mark.plugin) for isolated test execution
      - Reference Documentation: tests/README-plugins.md, tests/docs/plugin-testing-best-practices.md, tests/docs/plugin-api-reference.md from Story 7.6
    </standards>
    <locations>
      Documentation Files (Story 7.7 Creates):
      - docs/plugin-architecture.md (restructured to ≤300 lines navigation hub)
      - docs/plugin-development-guide.md (new, ≤500 lines)
      - docs/plugins/index.md (new, ≤200 lines)
      - docs/plugins/plugin-architecture-overview.md (new, ~400 lines)
      - docs/plugins/plugin-interface-reference.md (new, ~450 lines)
      - docs/plugins/plugin-manager-guide.md (new, ~400 lines)
      - docs/plugins/plugin-examples.md (new, ~500 lines)
      - docs/plugins/plugin-type-safety.md (new, ~400 lines)
      - docs/plugins/plugin-error-handling.md (new, ~400 lines)
      - docs/plugins/plugin-performance.md (new, ~400 lines)
      - docs/plugins/plugin-testing-guide.md (new, ~450 lines)
      - docs/plugins/plugin-submission-guidelines.md (new, ~450 lines)
      - docs/plugins/plugin-troubleshooting.md (new, ~450 lines)
      - docs/plugins/plugin-roadmap.md (new, ~400 lines)
      - README.md (updated with Plugin Architecture section)

      Template Files (Story 7.7 Creates):
      - src/plugins/_template/__init__.py (~50 lines)
      - src/plugins/_template/plugin.py (~250 lines with TODO comments)
      - src/plugins/_template/api_client.py (~200 lines with TODO comments)
      - src/plugins/_template/webhook_validator.py (~150 lines with TODO comments)
      - src/plugins/_template/README.md (~200 lines customization guide)

      Testing Documentation Reference (Story 7.6):
      - tests/README-plugins.md (Story 7.6 - link to, don't duplicate)
      - tests/docs/plugin-testing-best-practices.md (Story 7.6 - link to)
      - tests/docs/plugin-api-reference.md (Story 7.6 - link to)
    </locations>
    <ideas>
      Story 7.7 Testing Ideas (Documentation Validation):

      AC1 Validation - Documentation Restructure:
      - Verify plugin-architecture.md split into 7-8 modular files, each ≤500 lines
      - Confirm original plugin-architecture.md converted to navigation hub (≤300 lines)
      - Validate breadcrumb navigation present in all modular files
      - Check cross-references between files work correctly

      AC2 Validation - Development Guide:
      - Verify plugin-development-guide.md exists and follows Diátaxis tutorial framework
      - Confirm step-by-step Zendesk example present (15 steps from setup to deployment)
      - Validate code examples have syntax highlighting
      - Check "Testing Your Plugin" section links to Story 7.6 docs

      AC3 Validation - Plugin Template:
      - Verify src/plugins/_template/ directory created with 5 files (__init__.py, plugin.py, api_client.py, webhook_validator.py, README.md)
      - Confirm all template files ≤500 lines
      - Validate TODO comments present at all customization points
      - Check template README.md has TODO checklist
      - Verify template code passes Black formatting and mypy --strict (with placeholder types)

      AC4 Validation - Testing Requirements:
      - Verify plugin-testing-guide.md created with testing overview, strategy, mock plugin usage
      - Confirm references to tests/README-plugins.md from Story 7.6
      - Validate minimum coverage requirements documented (15+ unit, 5+ integration, 80%+ coverage)
      - Check performance testing guidance present (latency targets)

      AC5 Validation - Submission Guidelines:
      - Verify plugin-submission-guidelines.md created with 10-item code review checklist
      - Confirm security requirements section present (no hardcoded secrets, secrets.compare_digest)
      - Validate performance requirements documented (NFR001 latency targets)
      - Check PR template section included

      AC6 Validation - Troubleshooting Guide:
      - Verify plugin-troubleshooting.md created with common errors, debugging techniques
      - Confirm type checking issues section present (mypy errors)
      - Validate testing issues section included
      - Check webhook validation failures section present

      AC7 Validation - Plugin Roadmap:
      - Verify plugin-roadmap.md created with Priority 1 plugins (Zendesk, ServiceNow Q1 2026)
      - Confirm versioning strategy and deprecation policy sections present
      - Validate community contributions section included

      AC8 Validation - README Update:
      - Verify README.md updated with Plugin Architecture section
      - Confirm Supported Ticketing Tools subsection present (ServiceDesk Plus, Jira, future tools)
      - Validate Plugin Documentation links section with all 7+ doc links
      - Check links work correctly (no broken paths)
    </ideas>
  </tests>
</story-context>
